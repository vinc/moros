<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>MOROS Syscalls</title>
    <link rel="stylesheet" type="text/css" href="moros.css">
  </head>
  <body>
    <h1>MOROS Syscalls</h1>

    <p>This list is unstable and subject to change between versions of MOROS.</p>

    <h2>EXIT (0x01)</h2>

    <pre><code class="rust">fn exit(code: usize) -&gt; usize
</code></pre>

    <h2>SPAWN (0x02)</h2>

    <pre><code class="rust">fn spawn(path: &amp;str) -&gt; isize
</code></pre>

    <h2>READ (0x03)</h2>

    <pre><code class="rust">fn read(handle: usize, buf: &amp;mut [u8]) -&gt; isize
</code></pre>

    <h2>WRITE (0x04)</h2>

    <pre><code class="rust">fn write(handle: usize, buf: &amp;mut [u8]) -&gt; isize
</code></pre>

    <h2>OPEN (0x05)</h2>

    <pre><code class="rust">fn open(path: &amp;str, flags: usize) -&gt; isize
</code></pre>

    <p>The flags can be one or more of the following:</p>

    <pre><code class="rust">enum OpenFlag {
    Read     = 1,
    Write    = 2,
    Append   = 4,
    Create   = 8,
    Truncate = 16,
    Dir      = 32,
    Device   = 64,
}
</code></pre>

    <h2>CLOSE (0x06)</h2>

    <pre><code class="rust">fn close(handle: usize)
</code></pre>

    <h2>INFO (0x07)</h2>

    <pre><code class="rust">fn info(path: &amp;str, info: &amp;mut FileInfo) -&gt; isize
</code></pre>

    <p>This syscall will set the following attributes of the given structure:</p>

    <pre><code class="rust">struct FileInfo {
    kind: FileType,
    size: u32,
    time: u64,
    name: String,
}
</code></pre>

    <h2>DUP (0x08)</h2>

    <pre><code class="rust">fn dup(old_handle: usize, new_handle: usize) -&gt; isize
</code></pre>

    <h2>DELETE (0x09)</h2>

    <pre><code class="rust">fn delete(path: &amp;str) -&gt; isize
</code></pre>

    <h2>STOP (0x0A)</h2>

    <pre><code class="rust">fn stop(code: usize)
</code></pre>

    <p>The system will reboot with <code>0xCAFE</code> and halt with <code>0xDEAD</code>.</p>

    <h2>SLEEP (0x0B)</h2>

    <pre><code class="rust">fn sleep(seconds: f64)
</code></pre>

    <h2>POLL (0x0C)</h2>

    <pre><code class="rust">fn poll(list: &amp;[(usize, IO)]) -&gt; isize
</code></pre>

    <p>Given a list of file handles and <code>IO</code> operations:</p>

    <pre><code class="rust">enum IO {
    Read,
    Write,
}
</code></pre>

    <p>This syscall will return the index of the first file handle in the list that is
ready for the given <code>IO</code> operation or a negative number if no operations are
available for any file handles.</p>

    <p>For example polling the console will notify when a line is ready to be read,
or polling a socket will notify when it can receive or send.</p>

    <h2>CONNECT (0x0D)</h2>

    <pre><code class="rust">fn connect(handle, usize, addr: IpAddress, port: u16) -&gt; isize
</code></pre>

    <p>Connect a socket to an endpoint at the given <code>IpAddress</code> and port:</p>

    <pre><code class="rust">struct Ipv4Address(pub [u8; 4]);

struct Ipv6Address(pub [u8; 16]);

enum IpAddress {
    Ipv4(Ipv4Address),
    Ipv6(Ipv6Address),
}
</code></pre>

    <p>NOTE: Only IPv4 is currently supported.</p>

    <h2>LISTEN (0x0E)</h2>

    <pre><code class="rust">fn listen(handle, usize, port: u16) -&gt; isize
</code></pre>

    <h2>ACCEPT (0x0F)</h2>

    <pre><code class="rust">fn accept(handle, usize, addr: IpAddress) -&gt; isize
</code></pre>

    <h2>ALLOC (0x10)</h2>

    <pre><code class="rust">fn alloc(size: usize, align: usize) -&gt; *mut u8
</code></pre>

    <h2>FREE (0x11)</h2>

    <pre><code class="rust">fn free(ptr: *mut u8, size: usize, align: usize)
</code></pre>

    <h2>KIND (0x12)</h2>

    <pre><code class="rust">fn kind(handle: usize) -&gt; isize
</code></pre>

    <p>This syscall will return a integer corresponding to the <code>FileType</code> of the given
file handle when successful:</p>

    <pre><code class="rust">enum FileType {
    Dir = 0,
    File = 1,
    Device = 2,
}
</code></pre>
  <footer><p><a href="/">MOROS</a></footer>
  </body>
</html>
